#!/usr/bin/env node

var stream = require('through2')(function (chunk, enc, callback) {
  callback(null, "\nHI: " + chunk);
});

stream.pipe(process.stdout);

function stepA() {
  process.stdin.setRawMode(true);
  process.stdin.pipe(stream);

  setTimeout(stepB, 5000);
}

function stepB() {
  process.stdin.setRawMode(false);
  process.stdin.unpipe(stream);

  console.log("\nDONE #1")

  setTimeout(stepC, 5000);
}

function stepC() {
  process.stdin.setRawMode(true);
  process.stdin.pipe(stream);

  console.log("\nSTARTING #2")

  setTimeout(stepD, 5000);
}

function stepD() {
  console.log("\nDONE #2");
  setTimeout(process.exit, 5000);
}

stepA();